# 1. 오브젝트와 의존관계

## 1.1 초난감 DAO

```java
public class UserDao {
  public void add(User user) throws ClassNotFoundException, SQLException {
    Class.forName("com.mysql.jdbc.Driver");
    Connection c = DriverManager.getConnection("jdbc:mysql://localhost/springbook", "spring", book");
    
    PreparedStatement ps = c.preparedStatement(
      "insert into usres(id, name, password) values(?, ?, ?)");
    ps.setString(1, user.getId());
    ps.setString(2, user.getName());
    ps.setString(3, user.getPassword());
    
    ps.executeUpdate();
    
    ps.close();
    c.close();
  }

  public User get(String id) throws ClassNotFoundException, SQLException {
    Class.forName("com.mysql.jdbc.Driver");
    Connection c = DriverManager.getConnection("jdbc:mysql://localhost/springbook", "spring", book");
    
    PreparesStatement ps = c.prepareStatement(
      "select * from users where id = ?");
    ps.setString(1, id);
    
    ResultSet rs = ps.executeQuery();
    rs.next();
    User user = new User();
    user.setId(rs.getString("id"));
    user.setName(rs.getString("name"));
    user.setPassword(rs.getString("password"));
    
    rs.close();
    ps.close();
    c.close();
    
    return user;
  }
}
```

## 1.2 DAO의 분리

UserDao의 관심사항
1. DB 연결 관련된 관심
2. 어떤 쿼리 실행
3. 리소스 반환

### 중복 코드의 메소드 추출

connection 부분을 메소드로 추출할 수 있다.

하지만 커넥션을 사용자가 원하는 대로 바꾸고 싶다면 UserDao코드를 직접 수정해야만 한다.

=> 상속을 통한 확장(팩토리 메소드 패턴)

하지만 상속은 다중상속이 안되는 java에서는 큰 제약 조건이 된다.

## 1.3 DAO의 확장

### 클래스의 분리와 인터페이스의 도입

UserDao가 어떤 Connection을 사용할지에 관한 정보 또한 관심사가 될 수 있고 분리가 될 수 있다. UserDao를 사용하는 곳에서 UserDao와의 관계를 설정해주게 한다.

```java
public class UserDao {
  private ConnectionMaker connectionMaker;
  
  public UserDao(ConnectionMaker connectionMaker) {
    this.connectionMaker = connectionMaker;
  }
  
  public void add(User user) throws ClassNotFoundException, SQLException {
    Connection c = connectionMaker.makeConnection();
    ...
  }
  
  public User get(String id) throws ClassNotFoundException, SQLException {
    Connection c = connectionMaker.makeConnection();
    ...
  }
}
```

### 개방 폐쇄 원칙

클래스나 모듈은 확장에는 열려 있어야 하고 변경에는 닫혀 있어야 한다.

=> 기능을 확장하는데는 열려 있어야 하고, 자신의 핵심 기능을 구현한 코드는 그런 변화에 영향을 받지 않아야 한다.

**인터페이스를 사용해 확장 기능을 정의한 대부분의 API는 개방 폐쇄 원칙을 따른다고 볼 수 있다.**

### 높은 응집도와 낮은 결합도

응집도가 높다는건 하나의 모듈이나 클래스가 하나의 관심사에 집중되어 있다는 얘기이다.

응집도가 낮다면, 하나의 모듈에 여러 관심사가 있는 것이기 때문에 변경이 일어날 때 미치는 영향을 많이 생각해야 한다.

낮은 결합도는 서로 필요한 부분을 최소한으로 유지하는 것이다. 인터페이스를 통해서 최소한의 정보만 서로 알고 있을 수 있다.
