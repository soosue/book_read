# 9. 카프카 보안

---
카프카에 보안설정을 적용하려면 관리자가 직접 적용해야 한다.

주로 기업 내부 환경이라면 설정할 필요는 없긴 하다.

래빗MQ 같은 오픈소스는 기본적인 보안기능이 포함되어 있어서 초기 구성부터 보안을 적용할 수 있다.

---
## 9.1 카프카 보안의 세 가지 요소

---
외부와 연결이 되는 상황이라면 카프카에 보안은 필수적인 요소이다.

외부의 이상한 사용자 접속을 막는 `인증`.

외부로부터 패킷을 가로채졌을 때, 내용 보안을 위한 `암호화`.

이상한 토픽에 메시지 보내지 않기 위한 `권한`.

세 가지 모두 있어야 완벽한 보안이 갖춰진다.

---
### 9.1.1 암호화(SSL)

---
카프카도 HTTPS처럼 클라이언트와 암호화 통신을 위해 SSL을 사용.


---
### 9.1.2 인증(SASL)

---

카프카는 인증으로 SASL 방식을 이용한다.

SASL(simple authentication and security layer / 간단한 인증과 보안 계층) : 인터넷 프로토콜에서 인증과 데이터 보안을 위한 프레임워크

커버로스 : 티켓 기반 네트워크 인증 암호화 프로토콜

SASL/GSSAPI : 커버로스 인증방식

SASL/PLAIN : 아이디/비밀번호로 인증, 개발에서 사용할 것

SASL/SCRAM-SHA-256, 512 : 커버로스 없을 때 좋음. 인증 정보를 주키퍼에 저장, 토큰방식도 가능. (Salted Challenge Response Authentication Mechanism)

SASL/OAUTHBEARER : 카프카 아직 온전하지 않은 지원

---
### 9.1.3 권한(ACL)

---
카프카에서 메시지를 생성하거나 소비할 때 권한이 필요한 경우가 있다.

카프카에선 이런 권한을 CLI로 ACL을 추가하거나 삭제 가능하다.

모든 ACL 규칙은 주키퍼에 저장된다.

ACL을 리소스 타입별로 크게 _토픽_, _그룹_, 클러스터, 트랜잭셔널ID, 위임토큰으로 나뉜다.


---
## 9.2 SSL을 이용한 카프카 암호화

---
키스토어 : 본인의 인증서와 프라이빗 키를 저장하는 곳

트러스트스토어 : 신뢰하는 상대방의 root ca 인증서를 저장하는 곳

openssl명령어로 ca인증서 생성

브로커에 키스토어, 트러스트스토어
클라이언트에 트러스트스토어

클라이언트가 신뢰할 수 있는 네트워크 환경에 위치 : SSL x

클라이언트가 신뢰할 수 없는 네트워크 환경에 위치 : SSL o

이유 : SSL 통신 사용시 암/복호화 작업이 일어나므로, 브로커와 클라이언트에 부하 가중.

자바로 코드 구현시, 포트와 config파일만 변경

---
